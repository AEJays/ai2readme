export const SYSTEM_PROMPT = `你是一位资深开源项目维护者，正在撰写专业的中文 README 文档。

请根据项目信息，仅生成指定章节的内容。要求：
- 使用简洁、用户友好的语言
- 适当使用 emoji 提升可读性（如 🚀 ⚙️ 🔒 📁）
- 多用列表、代码块（仅用于命令、配置或目录结构）、表格，避免大段文字
- 所有命令必须用 \`...\` 或 \`\`\`bash ... \`\`\`
- **绝对不要输出任何 Markdown 标题符号（#）** - 不要重复章节标题
- **绝对禁止编造不存在的文件、函数或依赖** - 只使用代码中实际存在的内容
- 不要使用占位符（如 [...] 或 ...），必须生成完整内容
- 不要输出源代码、文件路径、调试信息（除非是"示例代码"章节）
- 不要出现"本项目""该系统"，直接说功能或操作
- **如果代码上下文不足以生成内容，请如实说明"暂无相关信息"**

只输出内容，不要任何解释。`;
/** 
* @author AEdge
* @description 根据项目章节键生成对应的章节提示，支持name、dependencies等章节，并处理项目信息
* @param {string} sectionKey - 要生成的章节键，如 'name', 'dependencies' 等
* @param {string} structure - 项目结构信息
* @param {string} codeContext - 项目代码上下文信息
* @param {string} rawDeps - 原始依赖数据
* @param {object} projectMeta - 项目元数据
* @returns string
* */
export const getSectionPrompt = (sectionKey, structure = '', codeContext = '', rawDeps = '', projectMeta = null) => {
  if (sectionKey === 'name') {
    return `请根据以下信息，写一句极具吸引力的项目副标题。

**任务步骤：**
1. **分析业务领域**：查看下方【代码信息】中的文件路径（如 src/views/bidding, src/views/procurement）和配置（APP_NAME: 采路通）。
2. **生成副标题**：必须描述项目是**做什么的**（业务价值），而不是**怎么做的**（技术栈）。

**禁止：**
- 绝对禁止写"基于 Vue/TypeScript"、"现代化工具"、"前端项目"等纯技术描述。
- 绝对禁止写"AI 助手"（除非项目明确是 AI 相关）。
- 绝对禁止以 \`>\` 符号开头。

**要求：**
- 直接输出副标题内容
- 长度控制在 30 字以内
- 语气要像产品标语，而不是技术文档
- 适当使用 emoji 增色

**参考示例：**
- 企业采购管理平台，降本增效 📦
- 轻量级个人博客，记录生活点滴 ✨
- 现代化后台管理模版，开箱即用 🛠️

【项目信息】
项目名称：${projectMeta?.name || '未知'}
项目描述：${projectMeta?.description || '无'}
配置信息：${codeContext?.includes('采路通') ? 'APP_NAME: 采路通' : ''}
关键文件提示：${codeContext || '无'}

**请直接输出副标题：**`;
  }
  let context = '';
  if (codeContext) {
    context += `【项目代码信息】
${codeContext}

请基于以上代码信息生成内容。要求：
- 必须基于实际代码，不要编造不存在的功能或文件
- 分析代码中的 import、函数名、类名来推断功能
- 使用代码中实际的导入路径和依赖`;
  } else {
    context += '【提示：由于没有提供代码信息，请根据项目名称生成通用的内容，不要编造具体细节】';
  }
  if (sectionKey === 'dependencies') {
    if (rawDeps) {
      context = `【真实依赖数据（已直接读取）】
${rawDeps}

【任务要求】
请基于上方【真实依赖数据】生成依赖说明。
- 必须基于上方列出的真实依赖进行整理和分类
- 不要编造上面没有的库
- 可以将库归类为"核心框架"、"工具库"等类别
- 生成格式请使用清晰的列表或分类表格`;
    } else {
      context += '\n\n⚠️ 注意：未检测到标准的依赖配置文件，请尽量从代码 import 语句中推断外部依赖。';
    }
  }
  const instructions = {
    intro: '简明介绍项目是做什么的，解决什么问题，以及核心价值。用 2～3 句话。\n\n**严格限制：只描述功能和价值，绝对不要写操作指南。**\n严禁包含：\n1. 安装步骤（如 npm install、pip install）\n2. 启动命令（如 npm run dev、python main.py）\n3. 网址链接（如 http://localhost）\n4 . 任何代码块（\`\`\`...）\n5. "安装与运行"、"使用方法"、"功能概述"等子标题。\n\n参考格式：\n"本项目是一个基于 Vue 3 的企业级采购管理系统，旨在帮助企业实现采购流程的数字化。通过集成 Arco Design 组件库，系统提供了从竞标管理到订单处理的完整解决方案，助力企业实现降本增效的目标。"',
    background: '请用自然、流畅的语言描述项目的业务背景。\n\n**要求：**\n- **严禁出现**"基于代码""路由配置""package.json""import"等技术分析类词汇。\n- 不要罗列功能，而是描述"解决了什么痛点"或"为什么需要这个系统"。\n- 用 1-2 句话描述传统做法的问题，再用 1 句话说明本系统的价值。\n\n示例：\n"传统的企业采购流程往往依赖人工流转，耗时长且信息不透明。本系统通过数字化手段重构了竞标与协议管理流程，让企业能够实时追踪采购进度，有效降低沟通成本并提升决策效率。"',
    structure: '',
    features: '基于代码分析，列出项目的主要核心特性。\n**输出格式必须为 Markdown 表格**（两列：特性 | 说明）。\n不要编造，只写代码中能体现的功能（如：支持数据库连接、图片压缩、异步处理等）。\n\n示例：\n| 特性 | 说明 |\n| --- | --- |\n| 异步处理 | 支持高并发请求处理 |\n| 数据加密 | 集成 AES 加密算法 |',
    install: '根据代码中的 package.json（如果有）或实际依赖文件生成安装步骤。\n- 如果是 Node.js 项目（有 package.json），使用 npm/yarn/pnpm 命令\n- 如果是 Python 项目（有 requirements.txt/pyproject.toml），使用 pip 命令\n- 如果需要 API Key 或配置，说明配置方法\n\n**注意：不要混用不同语言的安装命令，根据实际项目类型选择正确的命令。**\n\n示例（Node.js）:\n1. 安装依赖\n\`\`\`bash\nnpm install\n\`\`\`\n2. 启动项目\n\`\`\`bash\nnpm run dev\n\`\`\`',
    dependencies: '请根据【真实依赖数据】或代码上下文，整理并展示项目依赖。',
    example: '基于代码中的 main 函数、导出的类或函数，写一个类似 `test.js` 的完整使用示例。\n要求：\n1. 必须包含 import/require 语句（**使用完整的从项目根目录开始的路径**，如 `import { toUrl } from "./src/api/index"`，不要用 `../` 等相对路径）\n2. 演示如何初始化并调用主要功能\n3. **必须包裹在代码块中（标记语言）**\n4. 代码要简洁可运行\n5. 如果是 Vue 3 项目，可以写一个组件使用示例或 API 调用示例',
    usage: '基于代码中的主程序入口（如 main.py、if __name__ == "__main__"）说明如何运行。给出具体的启动命令和交互示例。用步骤 + 代码块。\n**注意：端口地址要根据实际配置文件中的端口设置，如果没有明确配置，使用默认端口（Vite 默认 5173，Webpack dev server 默认 8080）。**',
    workflow: '基于代码逻辑描述用户从启动到完成任务的完整流程。从 main 函数或入口文件推断执行流程。用"1. ... 2. ..."形式。',
    notes: '基于代码中的实际配置和错误处理，列出重要注意事项。不要使用通用的"编码问题"等无关警告。用带 ⚠️ 的列表。'
  };
  return `${instructions[sectionKey] || '请根据项目信息生成该部分内容。'}

${context}`.trim();
};

/** 
* @author AEdge
* @description 生成 README 全局润色和去重的 Prompt（仅改正文，死守 Header 和标题，重点去重安装/运行）
* @param {string} content - 原始 README 内容
* @returns string
*/
export const getRefineReadmePrompt = (content) => {
  return `你是一位资深技术文档编辑。请对以下 README 内容进行智能去重和润色，但必须严格遵守以下【强约束规则】。

【任务目标】
1. **智能去重（核心任务）**：
   - 重点检查“安装”和“运行/使用”章节。如果出现相同的命令（例如 \`npm install\` 在两处都出现，或 \`npm run dev\` 重复出现），请根据逻辑保留在最合适的章节（如 \`npm install\` 留在安装，\`npm run dev\` 留在运行），并**彻底删除另一处的重复内容**。
   - 检查其他章节是否存在重复的功能描述。如果存在，只保留最精炼的一处，删除冗余段落。
2. **语言润色**：修正语病、错别字，使文字更通顺、专业，避免口水话。

【强约束规则 - 必须遵守】
1. **绝对禁止修改头部 HTML**：
   - 从文档开头到第一个 \`##\` 二级标题之前的所有内容（包括 \`<h1 align="center">...\`、\`<p align="center">...\`、徽章图片 \`<img>\`、链接 \`<a>\`、换行符等）必须**原封不动地保留**。
2. **绝对禁止修改标题结构**：
   - 绝对禁止修改、删除或新增任何以 \`##\` 开头的二级标题，禁止改变章节顺序。
3. **代码块闭合（重要）**：
   - **请务必检查所有代码块**，确保每个代码块（以 \`\`\` 开头）都有对应的结束标记（\`\`\`）。
   - **绝对不要让代码块处于“打开”状态**，这会导致文档格式错乱。
4. **输出格式**：
   - 直接输出优化后的完整 Markdown 内容。
   - 不要包含任何解释性文字，不要使用 \`\`\`markdown 代码块包裹。

【待优化内容】
${content}`;
};
